-- Legal Pages Content
CREATE TABLE legal_pages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  page_type TEXT NOT NULL CHECK (page_type IN ('privacy', 'terms')),
  page_title TEXT NOT NULL,
  last_updated TEXT,
  content TEXT,
  sections JSONB DEFAULT '[]',
  is_published BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  UNIQUE(page_type)
);

ALTER TABLE legal_pages ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow public read legal_pages"
  ON legal_pages FOR SELECT TO anon, authenticated USING (is_published = true);

CREATE POLICY "Allow authenticated manage legal_pages"
  ON legal_pages FOR ALL TO authenticated USING (true) WITH CHECK (true);

-- Insert default content
INSERT INTO legal_pages (page_type, page_title, last_updated, content, sections) VALUES
  ('privacy', 'Privacy Policy', 'December 2024', 'This Privacy Policy describes how Orbit School collects, uses, and protects information.', 
   '[
     {"title": "Information We Collect", "content": "We collect information you provide directly to us, such as when you create an account, fill out a form, or contact us."},
     {"title": "How We Use Information", "content": "We use the information we collect to provide, maintain, and improve our services, and to communicate with you."},
     {"title": "Information Sharing", "content": "We do not sell, trade, or otherwise transfer your personal information to third parties without your consent."},
     {"title": "Data Security", "content": "We implement appropriate security measures to protect your personal information."},
     {"title": "Contact Us", "content": "If you have any questions about this Privacy Policy, please contact us."}
   ]'::jsonb),
  ('terms', 'Terms & Conditions', 'December 2024', 'Please read these Terms and Conditions carefully before using our services.', 
   '[
     {"title": "Acceptance of Terms", "content": "By accessing and using this website, you accept and agree to be bound by these terms and conditions."},
     {"title": "Use of Website", "content": "You may use our website for lawful purposes only and in accordance with these Terms."},
     {"title": "Intellectual Property", "content": "All content on this website is the property of Orbit School and is protected by copyright laws."},
     {"title": "Limitation of Liability", "content": "Orbit School shall not be liable for any indirect, incidental, or consequential damages."},
     {"title": "Changes to Terms", "content": "We reserve the right to modify these terms at any time. Changes will be effective immediately upon posting."}
   ]'::jsonb);